操作系统的概念
- 操作系统负责管理协调硬件,软件等计算机资源的⼯作
- 操作系统为上层⽤户,应⽤程序提供简单易⽤的服务
- 操作系统是⼀种系统软件 操作系统的特征
- 并发和共享最基本的两个性质
- 并发和共享互为存在条件 - 没有并发和共享,就谈不上虚拟和异步 并发 - 并发:两个或多个事件在同⼀时间间隔内发送【同⼀时间间隔】
并⾏:系统具有同时进⾏运算或操作的特性【同⼀时刻】

- 可并⾏的有【处理机与设备】【处理机与通道】【设备与设备】 - 不可并⾏的有【进程与进程】 - 真正实现并⾏的是多核处理机
•
共享 - 共享是指系统中的资源可供内存中多个并发执⾏的程序共同使⽤
互斥共享⽅式 - A⽤完之后,才可以给B⽤
- 如对摄像头设备的共享使⽤
同时共享⽅式 - ⼀段时间内由多个进程同时访问
- 如对硬盘资源的共享使⽤
虚拟 - 虚拟是指把⼀个物理上的实体变为若⼲逻辑上的对应物 空分复⽤技术【虚拟的扩充空间】 - 如虚拟存储器 时分复⽤技术【虚拟的扩充时间】 - 如处理器的分时共享 异步 - 进程的执⾏不是⼀贯到底的,⽽是⾛⾛停停的,它以不可预知的速度向前推进 操作系统的功能和⽬标 资源的管理者 处理器管理

- 处理机的分配和运⾏都以进程为基本单位,处理器管理=对进程的管理

- 主要功能:进程控制+进程同步+进程通信+死锁处理+处理机调度

•

存储器管理

- 为了给多道程序的运⾏提供良好的环境,⽅便⽤户使⽤及提⾼内存的利⽤率

- 主要功能:内存分配与回收+地址映射+内存保护+共享和内存扩充
•

⽂件管理

- 计算机的信息都是以⽂件的形式存在的
- 主要功能:⽂件存储空间的管理+⽬录管理+⽂件读写管理和保护

•

设备管理

- 主要是完成⽤户的I/O请求,⽅便⽤户使⽤各种设备,提⾼设备的利⽤率

- 主要功能:缓冲管理+设备分配+设备处理+虚拟设备
•

为用户和计算机硬件系统提供接口 给⽤户使⽤的
- GUI⽤户图像界⾯
- 命令接⼝
联机命令接⼝ 【⽤户发送⼀个命令,系统就执⾏⼀次,主要特点是交互性,适⽤于分时或实时系统】

脱机命令接⼝ 【⽤户⼀次性发送命令清单,系统按清单执⾏,中途不能⼲预,适⽤于批处理系统】

【解决独占问题】

•

给软件/程序员使⽤的

- 程序接⼝【即系统调⽤】
•

对计算机资源的扩充 - 裸机:没有任何软件⽀持的计算机

- 扩充机器/虚拟机:覆盖了软件的机器 操作系统结构 微内核OS知识点补充

- 优点:【内核⾜够⼩】【基于C/S模式】【应⽤机制与策略分离原理】【采⽤⾯向对象技术】

- 缺点:【性能问题】【开销偏⼤】
•

操作系统引导【开机过程】
启动过程:

1. CPU加电,CS:IP指向FFFF0H

2. 执⾏JMP指令跳转到BIOS

3. 登记BIOS中断例程⼊⼝地址 4. 硬件⾃检 5. 进⾏操作系统引导 引导过程 step1:CPU从⼀个特定主存地址开始,取指令,执⾏ROM中的引导程序【即前⾯的启动过程】

step2:将磁盘的第⼀块----主引导记录读入内存,执⾏磁盘引导程序,扫描分区表 step3:从活动分区【⼜称主分区,即安装了操作系统的分区】读⼊分区引导记录,执⾏其中的程序 step4:从根⽬录下找到完整的操作系统初始化程序【即启动管理器】并执⾏,完成开机的⼀系列操作 计算机加点启动过程中执⾏程序的过程:

⾃检程序---->引导装⼊程序/⾃举装⼊程序------>引导程序------>操作系统 注意点:

引导装⼊程序/自举装入程序-> 位于ROM中的⾃举程序(BIOS的组成部分)-> ⽤于启动具体的设备 引导程序/启动管理器-> 位于装有操作系统硬盘的活动分区的引导扇区的程序-> ⽤于引导操作系统 1、操作系统被装⼊RAM中 2、⾃举程序BIOS装在ROM中 3、引导程序装在硬盘中 虚拟机 定义 - 使用虚拟化技术,将一台物理机器虚化为多台虚拟机器VM,每个虚拟机器都可用独立运行一个操作系统 分类 操作系统发展历程 常考的三种操作系统对⽐

批操作系统 脱机使⽤计算机;作业是批处理的;系统内多道程序并发执⾏;交互能⼒差; 分时操作系统 多个⽤户同时使⽤计算机;⼈机交互强;具有每个⽤户独⽴使⽤计算机的独占性;系统响应及时 实时操作系统 能对控制对象做出及时反应;可靠性⾼;响应及时;但资源利⽤率低 其他操作系统对⽐

- Unix系统是多⽤户,多任务操作系统,属于分时操作系统 定义 特点 优点 缺点 手工操作阶段 - ⽤户独占全机,资源利⽤率低
- CPU等待⼿⼯操作,CPU的利⽤不充分 单道批处理系统 - 程序封闭性:程序执⾏的结果只取决于进程本身,不受外界影响
- 失去封闭性后,不同速度下的进程执⾏结果不同• ⾃动性,顺序性,单道性 - 资源利⽤率低,吞吐量⼩
多道批处理系统 - 批处理:允许多个⽤户将若⼲个作业提交给计算机系统集中处理
- 多道性是为了提⾼系统利⽤率和吞吐量⽽提出的• 多道,共享性,宏观上并⾏,微观上串⾏
- 引⼊多道后,系统就失去了封闭性和顺序性
- 制约性,程序执⾏因为共享资源和协同所有产⽣了竞争,相互制约
- 考虑到竞争的公平性,程序的执⾏是断续的
- 资源利⽤率⾼ - 系统吞吐量⼤
- CPU利用率高
- IO设备利用率高
- ⽤户响应时间⻓
不提供⼈机交互能⼒【批处理作业时⽤户⽆法⼲预】

【主要缺点】

•
分时操作系统 - 允许多个⽤户以交互的⽅式使⽤计算机的操作系统
- 要求快速响应⽤户是导致分时系统出现的重要原因 - 响应时间 = 时间⽚*⽤户 - 进程调度通常采⽤抢占式的优先级⾼者优先
- 同时性 - 交互性 - 独⽴性 - 及时性
- 提供⼈机交互能⼒ - 不能再规定的时间内做出处理 实时操作系统 在该操作系统下,计算机系统能及时处理由过程控制反馈的数 据,并及时做出响应

- 硬实时系统:必须在绝对严格的时间内 完成处理。如导弹控制系统,⾃动驾驶系统

•
软实时系统:能偶尔接受违反时间规定,如 12306火车订票系统

•
追求的⽬标:【安全可靠】

【及时处理】【快速处理】

•
分布式操作系统 - 分布性,并⾏性 网络操作系统 - ⽹络中各种资源的关系及各台计算机之间的通信 操作系统运⾏的环境 处理器运⾏的机制 程序运⾏的原理 - ⾼级语⾔编写代码,然后转换为机器指令
- 程序运⾏的过程就是CPU执⾏指令的过程 两种程序 - 内核程序

- 应⽤程序 两种指令 特权指令 指不允许⽤户直接使⽤的指令 - 对I/O设备操作指令

- 存取特殊寄存器的指令

- 有关访问程序状态的指令

- 置中断指令

- 关中断指令

- 清内存指令

- 置时钟指令

⾮特权指令 允许⽤户直接使⽤的指令 不能直接访问系统中的软硬件资源 只限于访问⽤户的地址空间

- 访管/trap指令 两种处理器状态 核⼼态【管态】 只能在核⼼态运⾏的指令和程序:

- 时钟管理相关的指令【置时钟指令】

- 中断机制相关的指令【时钟中断程序】

- 原语相关的指令

- 系统控制的数据结构与处理【进程调度程序】【进程切换】【缺⻚处理程序】【系统调⽤命令】

•

⽤户态【⽬态】 在⽤户态运⾏的指令和程序/发⽣的事件:

- 命令解释程序【属于命令接⼝,⾯向⽤户】

- 访管/Trap指令,跳转指令,压栈指令

- 广义指令(系统调用)的调用
- 外部中断,缺页

•

如何变态 内核态-- >⽤户态 发⽣在中断返回⽤户程序时,需要⼀条修改PSW(程序状态字)的特权命令

⽤户态-->内核态 发生在中断时,通过硬件完成 为什么要区别核⼼态和⽤户态? 为了保护系统程序 内核的功能

- 时钟管理:实现计时功能 - 中断处理:负责实现中断机制
- 设备管理:完成设备的请求和释放,以及设备启动等功能
- ⽂件管理:完成⽂件的读,写,创建和删除等功能
- 进程管理:完成进程的创建,撤销,阻塞及唤醒等功能 - 进程通信:完成进程之间的信息传递或信号传递等功能
- 内存管理:完成内存的分配,回收以及获取作业占⽤内存区⼤⼩及地址等功能 原语

- 是⼀种特殊的程序
- 处于操作系统最底层,是最接近硬件的部分
- 该程序运⾏具有原⼦性(运⾏只能⼀⽓呵成,不可中断) - 运⾏时间较短,调⽤频繁
•
外中断和内中断(异常和中断控制【结合OS学习】)
异常(内中断) 中断(外中断)

基本概念 - 由CPU内部产⽣的意外事件

- 是CPU执⾏⼀条命令时,由CPU在其内部检测到的、与正在执⾏指令相关的同步事件

- 故障和⾃陷为异常

- 终⽌异常和外中断属于硬件中断

- 由来⾃CPU外部的设备发出的中断请求(常⽤于输⼊输出)

- 典型的由外部设备触发的、与当前正在执⾏的指令⽆关的异步事件

- 外部I/O设备通过特定的中断请求信号线向CPU提出中断请求

- CPU每执⾏完⼀条指令就检查中断请求信号线,若检测到中断请求,则进⼊中断响应期

- 外部中断都是在⼀条指令执⾏完成后(中断周期)才被检测并处理的 分类 故障 - 在引起故障的指令启动之后、执⾏结束前被检测到的异常事件

⾃陷 - 也称陷阱或陷⼊,是预先安排的⼀种"异常事件",就像预先设置好的"陷阱"⼀样 终⽌ - 若在执⾏指令的过程中发⽣了使计算机⽆法继续执⾏的硬件故障,那么程序将⽆法继续执⾏,只能终⽌

可屏蔽中断 - 通过可屏蔽中断请求线INTR向CPU发出的中断请求

- CPU可以通过在中断控制器中设置相应的屏蔽字来屏蔽或不屏蔽它,被屏蔽的中断信号将不被送到CPU

不可屏蔽中断 - 通过不可屏蔽中断请求线NMI向CPU发出的中断请求
- 通常是⾮常紧急的硬件故障,如电源掉电等。

举例 故障 - 指令译码时,出现"⾮法操作码"

- 取数据时,发⽣"缺段"或"缺⻚"

- 除数为零

- 地址越界

⾃陷 - x86机器中,⽤于程序调试"断点设置"和单步跟踪功能
- 系统调⽤指令
- 条件⾃陷指令 终⽌ - 控制器出错

- 存储器校验错

- 调出中断服务程序来重启系统

- Cache缺失
- I/O中断:键盘输⼊,打印机缺纸

- 时钟中断

- I/O中断请求 执行时间 - CPU在执⾏指令时会检查是否有异常发⽣ - 每个指令周期末尾,CPU都会检查是否有外中断信号需要处理 不同点 - 缺⻚"或"溢出"等异常事件是由特定指令在执⾏过程中产⽣的

- 异常的检测由CPU⾃身完成,不必通过外部的某个信号通知CPU
- 中断不与任何指令相关联,也不阻⽌任何指令的完成 系统调⽤【⼜叫做⼴义指令】

定义 - 操作系统对应⽤程序和程序员提供的接⼝

- 系统调⽤需要触发Trap【也叫陷⼊/访管指令】

- os通过提供系统调⽤避免⽤户程序直接访问外设【应⽤程序通过系统调⽤使⽤OS的设备管理服务】

⽬的 请求系统服务 与库函数的区别 库函数 系统调用

- 是语⾔或应⽤程序的⼀部分,可以运⾏在⽤户空间中 - 是操作系统的⼀部分,是内核为⽤户提供的程序接⼝,运⾏在内核空间
- 许多库函数都会使⽤系统调⽤来实现功能
- 有的库函数没有使⽤系统调⽤未使⽤系统调⽤的库函数,执⾏效率通常⽐系统调⽤的⾼
【因为系统调⽤要完成上下⽂的切换和状态的转换】

•
按功能分类 - 设备管理:完成设备的请求或释放+设备启动

- ⽂件管理:完成⽂件的读+写+创建+删除

- 进程控制:完成进程的创建+撤销+阻塞+唤醒 - 进程通信:完成进程之间的信息传递或信号传递
- 内存管理:完成内存的分配+回收+获取作业占⽤内存区⼤⼩及始址 系统调⽤的过程 step1:传参 step2:陷⼊指令/Trap/访管【执⾏系统调⽤】,发⽣在⽤户态 step3:由操作系统内核程序处理系统调⽤请求,发⽣在内核态 step4:返回应⽤程序 常考点 底⾊标记为红⾊的常考点是我做题总结的,底⾊标记为绿⾊的知识点是按王道书的体系制作的 前者⽤于快速复习,后者⽤于全⾯复习 1、微内核 微内核定义 - 只把核⼼功能放⼊内核,其余功能⽤⽤户进程的形式运⾏在⽤户态 微内核优点 - 内核⾜够⼩

- 基于C/S模式

- 应⽤机制与策略分离原理

- 采⽤⾯向对象技术 微内核缺点 执⾏效率不⾼

开销较⼤

•

2、操作系统的引导,即开机过程 A、启动过程 1. CPU加电,CS:IP指向FFFF0H

2. 执⾏JMP指令跳转到BIOS

3. 登记BIOS中断例程⼊⼝地址 4. 硬件⾃检 5. 进⾏操作系统引导 B、引导过程 step1:CPU从⼀个特定主存地址开始,取指令,执⾏ROM中的引导程序【即前⾯的启动过程】

step2:将磁盘的第⼀块----主引导记录读入内存,执⾏磁盘引导程序,扫描分区表 step3:从活动分区【⼜称主分区,即安装了操作系统的分区】读⼊分区引导记录,执⾏其中的程序 step4:从根⽬录下找到完整的操作系统初始化程序【即启动管理器】并执⾏,完成开机的⼀系列操作 C、计算机加电启动过程中执行程序的过程

⾃检程序---->引导装⼊程序/⾃举装⼊程序------>引导程序------>操作系统 D、注意点 引导装⼊程序/自举装入程序 是位于ROM中的⾃举程序(BIOS的组成部分) ⽤于启动具体的设备 引导程序/启动管理器 是位于装有操作系统硬盘的活动分区的引导扇区的程序 ⽤于引导操作系统 1、操作系统被装⼊RAM中 2、⾃举程序BIOS装在ROM中 3、引导程序装在硬盘中 3、常考的三种操作系统对比 批操作系统 脱机使⽤计算机;作业是批处理的;系统内多道程序并发执⾏;交互能⼒差; 分时操作系统 多个⽤户同时使⽤计算机;⼈机交互强;具有每个⽤户独⽴使⽤计算机的独占性;系统响应及时 实时操作系统 能对控制对象做出及时反应;可靠性⾼;响应及时;但资源利⽤率低 4、常见的特权指令和非特权指令 特权指令 指不允许⽤户直接使⽤的指令 - 对I/O设备操作指令

- 存取特殊寄存器的指令

- 有关访问程序状态的指令

- 置中断指令

- 关中断指令

- 清内存指令

- 置时钟指令

⾮特权指令 允许⽤户直接使⽤的指令 不能直接访问系统中的软硬件资源 只限于访问⽤户的地址空间

- 访管/trap指令 5、常见的在管态和在目态运行的程序 核⼼态【管态】 在核⼼态运⾏的指令和程序:

- 时钟管理相关的指令【置时钟指令】

- 中断机制相关的指令【时钟中断程序】

- 原语相关的指令

- 系统控制的数据结构与处理【进程调度程序】【进程切换】【缺⻚处理程序】【系统调⽤命令】

⽤户态【⽬态】 在⽤户态运⾏的指令和程序/发⽣的事件:

- 命令解释程序【属于命令接⼝,⾯向⽤户】

- 访管/Trap指令,跳转指令,压栈指令

- 广义指令(系统调用)的调用
- 外部中断,缺页 6、外中断和内中断(见右边详细知识点)

7、系统调用(见右边详细知识点)

第⼀章 计算机系统概述 2022年9月6日 星期二 16:45