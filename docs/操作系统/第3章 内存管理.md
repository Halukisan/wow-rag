内存管理概念 常考点 与覆盖交换技术相关

(23年不考)
1.使⽤交换技术时,⼀个进程正在I/O操作,则不能交换出主存;开辟⼀个缓冲I/O区后,可以交换出主存 2.覆盖和交换的提出是为了解决主存空间不⾜的问题,不是从物理上解决,⽽是将暂时不⽤的部分换出主存 以节省空间,从⽽在逻辑上扩充主存 3.单⼀连续存储管理可采⽤覆盖技术 程序运行过程相关 1.形成逻辑地址的阶段:链接 2.形成物理地址的阶段:装⼊或程序运⾏时 与重定位相关 1.动态重定位是在作业的执⾏过程中进⾏的 2.静态重定位是在转⼊的时候进⾏的 3.固定分区可以采⽤静态重定位(装⼊后位置不再改变)

4.在整个系统设置一个重定位寄存器,⽤来存放程序在内存中的始址 其他 1.内存保护需要由OS和硬件机构合作完成,以保证进程空间不被⾮法访问 基本概述 内存管理是什么? - 内存管理是操作系统对内存的划分和动态分配 内存管理的目的 1. 为了更好地⽀持多道程序并发执⾏

2. ⽅便⽤户 3. 提⾼内存利⽤率 内存管理的功能 1.内存空间的分配与回收 由OS完成主存储器空间的分配和管理 2.地址转换 存储管理将逻辑地址转换为物理地址 3.内存空间的扩充 利⽤虚拟存储技术/⾃动覆盖技术,从逻辑上扩充内存 4.内存共享 允许多个进程访问内存的同⼀部分 4.存储保护 保证多道作业在各⾃的存储空间运⾏,互不⼲扰 内存管理的分配 1.连续分配 单⼀连续分配--「单道发展到多道OS」-->固定分区分配--「为了适应⼤⼩不同的程序」-->动态分区分配 2.不连续分配 分段存储管理--->分⻚存储管理--->段⻚存储管理 将程序变成可在内存中执⾏的程序过程【也就是程序的链接与接⼊过程】

过程图 step1:编译 编译:由编译程序将⽤户源代码编译成若⼲⽬标模块 step2:链接 链接:由链接程序将⽬标模块和库函数链接,形成完整的装⼊模块 链接类别

- 静态链接 

- 动态链接

- 运⾏时动态链接 step3:装入 装⼊:是由装⼊程序将装⼊模块装⼊内存运⾏

装⼊类别

- 静态装⼊:在编程时把物理地址计算好

- 可重定位装⼊:装⼊时把逻辑地址转换为物理地址,但装⼊后不能改变

- 动态重定位装⼊:执⾏时再决定装⼊的地址并装⼊,装⼊后有可能会换出 例图 逻辑地址与物理地址 逻辑地址 物理地址 定义 每个⽬标模块都从0号单元开始编址的地址 物理地址空间是指内存中物理单元的集合 特点 - 不同进程可以有系统的逻辑地址,这些逻辑地址可以映射到主存的不同位置

- 进程运⾏时,看到和使⽤的地址都是逻辑地址

- 将逻辑地址转换为物理地址的过程叫做地址重定位

- 物理地址是地址转换的最终地址 进程的内存映像【详⻅→进程的控制结构/数据结构】

定义 当⼀个进程调⼊内存运⾏时,就构成了进程的内存映像 组成要素 1.代码段 - 代码段是只读的,可以被多个进程共享 2.数据段 - 程序运⾏时加⼯处理的对象,包括全局变量和静态变量 3.进程控制块PCB - 存放在系统区,OS通过PCB控制和管理进程 4.堆 - ⽤来存放动态分配的变量【动态的】

5.栈 - ⽤来实现函数调⽤的【动态的】

内存保护 目的 确保每个进程都有⼀个单独的内存空间 方法 ⽅法1.在CPU中设置⼀对上下限存储器,判断CPU访问的地址是否越界

⽅法2.使⽤重定位寄存器和界地址寄存器(只有OS内存才可以使⽤这两个寄存器)

- 重定位寄存器/基地址寄存器含最⼩的物理地址值【⽤于"加"】

- 界地址寄存器含逻辑机制的最⼤值【⽤于"⽐"】

- 逻辑地址+重定位寄存器的值=物理地址 例图 内存共享 概念 - 只有只读区域的进程空间可⽤共享

- 纯代码/可重⼊代码 = 不能修改的代码,不属于临界资源

- 可重⼊程序通过减少交换数量来改善系统性能 实现方式 1.段的共享 2.基于共享内存的进程通信(第⼆章的同步互斥)

3.内存映射⽂件 内存管理⽅法 分⻚和分段的⽐较 分段 分页 段页式 地址映射表 每个进程由多个不等的段组成 每个进程⼀张⻚表,且进程的⻚表驻留在内存中 每个进程⼀张段表,每个段⼀张⻚表 地址结构 段号+段内偏移 ⻚号+⻚内偏移 段号+段内⻚号+⻚内偏移量 地址结构维度 ⼆维 ⼀维 ⼆维 供什么感知 供⽤户感知 供操作系统感知 ⽆

以什么单位划分 - 以段为单位分配

- 每段是⼀个连续存储区

- 每段不⼀定等⻓

- 段与段之间可连续,也可不连续

- 逻辑地址分配按⻚分配

- 物理地址分配按内存块分配
- 分段⽅法来分配管理⽤户地址空间
- 分⻚⽅法来管理物理存储空间 长度是否固定 段⻓不固定 ⻚⻓固定 段⻓不固定,⻚⻓固定 访问主存次数 2次 2次 3次 碎片情况 只产⽣外部碎⽚ 产⽣内部碎⽚ 产⽣内部碎⽚

常考点 共享相关 1.段的共享是通过两个作业的段表中相应表项指向被共享的段的统⼀物理副本实现的 存储器相关 1.对主存储器的访问以字节或字为单位 2.对主存储器的分配以块或段为单位 其他 1.确定⼀个地址需要⼏个参数,作业地址空间就是⼏维的

⽅法⼀:连续分配 定义 连续分配管理是为⼀个⽤户程序分配⼀个连续的内存空间 特点 - ⽤户程序在主存中都是连续存放的

- ⾮连续分配的⽅式的存储密度 < 连续分配⽅式 碎片 - 内部碎⽚:当程序⼩于固定分区⼤⼩时,也要占⽤⼀个完整的内存分区,导致分区内部存在空间浪费

- 外部碎⽚:内存中产⽣的⼩内存块 分类 1.单⼀连续分配 2.固定分区分配 定义 - 在此⽅法下,内存分为两个区

- 系统区:供OS⽤,在地址区

- ⽤户区:内存⽤户空间由⼀道程序独占

- ⽤户内存空间划分为固定⼤⼩(分区⼤⼩相等或不等)的区域

- 每个区装⼀道作业 优点 - 简单,⽆外部碎⽚

- ⽆需进⾏内存保护(内存中永远只有⼀道程序)

- 简单 缺点 - 只能⽤于单⽤户单任务的OS

- 有内部碎⽚,存储器利⽤率极低
- 程序太⼤可能放不下任何⼀个分区,有内部碎⽚
- 不能实现多进程共享⼀个主存区,存储空间利⽤率低 3.动态分区分配:进程转⼊内存时,根据进程的实际需要,动态地分配内存;动态分区是在作业装⼊时动态建⽴的 动态分配算法 按什么次序链接的 特点 a.⾸次适应算法 按地址递增的次序 最简单,效果最好,速度最快 b.邻近适应算法 ⽐⾸次适应算法差 c.最佳适应算法 按容量递增的次序 性能很差,会产⽣最多的外部碎⽚

d.最坏适应算法 按容量递减的次序 可能导致没有可⽤的⼤内存块,性能差

⽅法⼆:分段 概念 分段 = 程序由若⼲个逻辑分段组成,不同的段有不同的属性,⽤分段的⽅式把程序进⾏分离 段表 = ⼀张逻辑空间与内存空间映射的表 概念图 段的共享与保护 - 段的共享 = 通过两个作业的段表中相应表项指向被共享的段的同⼀物理副本 段的保护有两种

- 存储控制保护

- 地址越界保护

•

优缺特点 优点 缺点 特点

- 能产⽣连续的内存空间

- 分段存储管理能反映程序的逻辑结构并有利于段的共享和保护

- 程序的动态链接与逻辑结构有关,分段存储管理有利于程序的动态链接

- 会产⽣外部碎⽚

- 内存交换的效率低

- 满⾜程序员/⽤户

- ⽅便编程,分段共享

- 分段保护,动态链接,增⻓

- 分段管理地址空间是⼆维的

- 每段的⻓短不同 地址变换 物理地址 = 段基址 + 偏移量

⽅法三:分⻚

概念 分⻚ - 把整个虚拟和物理内存空间切成⼀段段固定尺⼨的⼤⼩,在linux中,每⼀⻚的⼤⼩为4kB

⻚/⻚⾯ - ⻚就是进程中的块

- ⻚⾯⼤--->⻚内碎⽚增多,降低内存的利⽤率

- ⻚⾯⼩--->进程的⻚⾯数⼤,⻚表过⻓,占⽤⼤量内存,增加硬件地址转换的开销,降低⻚⾯换⼊/出的效率 地址结构 - 地址结构 = ⻚号P+⻚内偏移量W

- 地址结构决定了虚拟内存的寻址空间有多⼤

- 完成地址转换⼯作的是有硬件的地址转换机构,⽽不是地址转换程序

⻚表 - ⻚表就是记录⻚⾯在内存中对应的物理块号

- ⻚表的起始地址放在⻚表基址寄存器PTBR中

- ⻚表是存储在内存⾥的,内存管理单元 (MMU)就做将虚拟内存地址转换成物理地址的⼯作。

相关计算1 相关计算2 优缺特点 优点 缺点 特点

- 能有效地提⾼内存利⽤率 - 会产⽣内部碎⽚ - 逻辑地址分配按⻚分配

- 物理地址分配按内存块分配

- 划分的⻚⾯⼤⼩都相同

- 所有进程都有⼀张⻚表

- ⻚表存在内存中

- 分⻚是⾯向计算机的 整个系统设置⼀个⻚表寄存器⽤于 存放⻚表在内存中起始地址和⻓度

•

分⻚的地址变换 知识点 结构图 基本地址变换 1. 把虚拟内存地址,切分成⻚号和偏移量 2. 根据⻚号,从⻚表⾥⾯,查询对应的物理⻚号 3. 直接拿物理⻚号,加上前⾯的偏移量,就得到了物理内存地址 分⻚产⽣的⻚表过⼤,使⽤多级⻚表,解决空间上的问题 两级页表地址变换 1. ⼀级⻚表覆盖到全部虚拟地址空间,⼆级⻚表在需要时创建 建⽴多级⻚表的⽬的在于建⽴索引,以便不⽤浪费主存空间区存 储⽆⽤的⻚表项,也不⽤盲⽬地顺序式查找⻚表项 2.

3. ⻚表寄存器存放的是⼀级⻚表起始物理地址 很多层参与,时间上开销⼤,加⼊TLB,提⾼地址的转换速度 具有快表的地址变换 - 快表是相联存储器(Translation Lookaside Buffer,TLB)

- 快表也叫⻚表缓存,转址旁路缓存

- 快表专⻔存放程序最常访问的⻚表项的Cache

- 快表位于CPU芯⽚中,⽤于加速地址变换的过程

- CPU芯⽚中,封装了MMU(内存管理单元)

- MMU⽤来完成地址转换和TBL的访问与交互

⽅法四:段⻚

实现方法 step1:将程序划分为多个有逻辑意义的段【分段】

step2:对分段划分出来的连续空间,再划分固定⼤⼩的⻚【分⻚】

地址变换 - 作业的逻辑地址划分为:段号,段内⻚号,⻚内偏移量

- 对内存的管理以存储块为单位,地址空间是⼆维的 得到物理地址 的3次内存访问

- 1.访问段表,得到⻚表起始地址

- 2.访问页表,得到物理⻚号

- 3.将物理页号与页内偏移组合,得到物理地址 虚拟内存的实现 常考点 虚拟存储概念相关 - 虚拟存储器的最⼤容量是由计算机的地址结构决定的,与主存容量和外存容量没有关系

- 虚拟存储技术基于程序的局部性原理,局部性越好,虚拟存储系统越能更好地发挥作⽤

- 虚拟存储技术只能基于⾮连续分配技术

- 使⽤覆盖,交换⽅法可以实现虚拟存储 页面置换算法相关 - ⽆论采⽤什么⻚⾯置换算法,每种⻚⾯第⼀次访问时不可能在内存中,必然发⽣缺⻚,所以缺⻚次数≥ 不同的页号数量 缺页中断相关 - 请求分⻚存储器中,⻚⾯尺⼨增⼤,存放程序需要的⻚帧数减少,缺⻚中断次数也会减少

- 影响缺⻚中断的时间有:缺⻚率,磁盘读写时间,内存访问时间

- 缺⻚中断可能执⾏的操作:置换⻚⾯,分配内存(不会进⾏越界出错处理)

- 缺⻚处理过程中可能执⾏的操作:修改⻚表,分配⻚框,磁盘I/O(内存没有⻚⾯,需要从外存读⼊)

其他 - 系统调⽤是由⽤户进程发起的,请求OS的服务

- 创建新进程可以通过系统调⽤完成

- 可以加快虚实地址转换的操作:增⼤快表TLB的容量,让⻚表常驻内存

- 当磁盘利⽤率很⾼,但是CPU利⽤率不⾼时,改进CPU利⽤率的操作:增⼤内存的容量,减少多道程序的度数 基本概念 传统存储管理方式的特征 ⼀次性 - 作业必须⼀次性全部装⼊内存,才能开始运⾏

驻留性 - 作业被装⼊内存后,就⼀直驻留在内存中,直到作业结束

- 运⾏中的进程会因等待I/O⽽被阻塞,可能处于⻓期等待状态 局部性原理 时间局部性 - 程序中的某条指令⼀旦执⾏,不久后该指令可能再次运⾏;出现的原因是程序中存在着⼤量的循环结构 空间局部性 - 程序在⼀段时间内所访问的地址,可能集中在⼀定的范围内 虚拟存储器 定义 - 系统为⽤户提供的⼀个⽐实际内存容量⼤得多的存储器 特征 - 多次性 = 即只需将当前运⾏的那部分程序和数据装⼊内存即可开始运⾏【最重要的特征】

- 对换性 = 即作业⽆需⼀直常驻内存,要⽤时换⼊,不要⽤时换出

- 虚拟性 = 从逻辑上扩充内存的容量【最重要的⽬标】

虚拟内存的实现 ⽅式(离散分配) 1.请求分⻚存储管理 2.请求分段存储管理 3.请求段⻚式存储管理 需要的东⻄ - ⼀定的硬件⽀持,⼀定容量的内存和外存

- ⻚表/段表机制作为主要的数据结构

- 中断机制,当程序要访问的部分还未调⼊内存时,产⽣中断

- 地址变换机构 请求分⻚管理⽅式 特点 - 只要求将当前⼀部分⻚⾯装⼊内存,便可启动作业运⾏,不需要⼀次全部装⼊

- 在作业执⾏的过程中,当访问的⻚⾯不存在时,再通过调⻚功能将其调⼊

相比基本分页管理增加的功能 - 请求调⻚功能:将要⽤的⻚⾯调⼊内存【调⼊】

- ⻚⾯置换功能:将不⽤的⻚⾯换出到外存【调出】

页表的构成 ⻚号+⻚框号+状态位P+访问字段A+修改位M+外存地址L

页面机制新增四个字段 状态位/合法位P 标记该⻚是否已被调⼊内存中 供程序访问时参考,⽤于判断是否触发缺⻚异常 访问字段A 记录本⻚在⼀段时间内被访问的次数 供置换算法换出⻚⾯时参考 修改位M 标识该⻚在调⼊内存后是否被修改过 当⻚⾯被淘汰时,若⻚⾯数据没有修改,则不⽤写回外存 外存地址L ⽤于指出该⻚在外存上的地址,通常是物理块号 供写回外存和从外存中调⼊此⻚时参考 缺页中断 定义 - 缺⻚是在CPU执⾏某条指令过程中,进⾏取指令或读写数据时发⽣的⼀种故障,是内中断或者叫做异常 产⽣时间 - 每当要访问的⻚⾯不在内存中时,便产⽣⼀个缺⻚中断,请求OS将所缺的⻚调⼊内存

- 缺⻚中断是访存指令引起的,说明所要访问的⻚⾯不在内存中

- 进⾏缺⻚中断处理并调⼊所要访问的⻚后,访存指令应该重新执⾏

特点 - 在指令执⾏期间⽽⾮⼀条指令执⾏完后产⽣和处理中断信号

- ⼀条指令在执⾏期间,可能产⽣多次缺⻚中断 地址变换机构新增功能 1.产⽣和处理中断信号 2.从内存中换出⼀⻚

地址变换过程

⻚框分配(进程准备执⾏时,由OS决定给特定进程分配⼏个⻚框)

驻留集是什么 - 驻留集 = 给⼀个进程分配的物理⻚框(也叫做物理块)的集合 驻留集的大小 1.分配给进程的⻚框越少,驻留在内存的进程就越多,CPU的利⽤率就越⾼

2.进程在主存中的⻚⾯过少,缺⻚率相对较⾼

3.分配的⻚框过多,对进程的缺⻚率没有⼤的影响 分配策略 固定分配局部置换 - 物理块固定,缺⻚时先换出⼀个线程再调⼊所缺⻚

可变分配全局置换 - 物理块可变,缺⻚时增加物理块再调⼊所缺⻚

可变分配局部置换 - 物理块可变,若不频繁缺⻚则⽤局部置换,频繁缺⻚再⽤全局置换

 :对各进程进⾏固定分配时⻚⾯数不变,不可能出现全局置换 物理块调入算法 1.平均分配算法 2.按⽐例分配算法 3.优先权分配算法 调入页面的时机 预调⻚策略 = 运⾏前的调⼊ - 主要⽤于进程的⾸次调⼊,由程序员指出应先调⼊哪些⻚

请求调⻚策略 = 运⾏时的调⼊ - 调⼊的⻚⼀定会被访问,策略易于实现

- 每次仅调⼊⼀⻚,增加了磁盘I/O开销 请求分页系统外存组成 - 存放⽂件的⽂件区【采⽤离散分配⽅式】

- 存放对换⻚⾯的对换区【采⽤连续分配⽅式】

 对换区的磁盘I/O速度更快 从何处调入页面 1.系统拥有⾜够的对换区空间 2.系统缺少⾜够的对换区空间 3.UNIX⽅式 如何调入页面 情况1:所访问的⻚⾯不在内存时--->缺⻚中断--->⽆空闲物理块--->决定淘汰⻚--->调出⻚⾯--->调⼊所缺⻚⾯

情况2:所访问的⻚⾯不在内存时--->缺⻚中断--->有空闲物理块--->调⼊所缺⻚⾯

⻚⾯置换算法(即选择调出⻚⾯的算法)

最佳置换算法OPT 先进先出置换算法FIFO 最近最久未使用置换算法LRU 时钟置换算法CLOCK

英文全名 Optimal replacement First In First Out Least Recently Use Clock 被淘汰的页面 以后永不使⽤的 在内存中驻留时间最久的⻚⾯ 最近最⻓时间未访问过的⻚⾯ 最近未使⽤的⻚⾯

特点 - 基于队列实现的

- 该算法⽆法实现

- 只能⽤于评价其他算法 会出现Belady异常

(分配的物理块数增⼤但⻚故障数不减反增)

•

- 性能差,但实现简单

- 性能好,但实现复杂

- 需要寄存器和栈道硬件⽀持

- 堆栈类算法

- 耗费⾼因为要对所有⻚排序

- FIFO和LRU的结合 其他零散知识点 抖动/颠簸 定义 - 在⻚⾯置换时,出现频繁的⻚⾯调度⾏为

- 所有⻚⾯置换策略都有可能造成抖动 产⽣原因 - 系统中同时运⾏的进程太多—>分配给每个进程的物理块太少—>进程在运⾏时频繁出现缺⻚—>频繁的调动⻚⾯

- 主要原因是因为⻚⾯置换算法不合理 解决⽅法 - 撤销部分进程

- 增加磁盘交换区⼤⼩和提⾼⽤户进程优先级都与抖动⽆关 工作集 定义 - 在某段时间间隔内,进程要访问的⻚⾯集合 如何确定⼯作集 - 基于局部性原理,⽤最近访问过的⻚⾯来确认 有什么作⽤ - ⼯作集反映了进程在接下来⼀段时间内很可能频繁访问的⻚⾯集合

- 为了防⽌抖动现象,要使分配给进程的物理块数>⼯作集⼤⼩

例题 内存映射文件 定义 - 与虚拟内存有些相似,将磁盘⽂件的全部或部分内容与进程虚拟地址空间的某区域建⽴映射关系 作⽤ - 可以直接访问被映射的⽂件,⽽不必执⾏⽂件I/O操作,也⽆需对⽂件内容进⾏缓存处理 优点 - 适合⽤来管理⼤尺⼨⽂件 虚拟存储器性能影响因素 1. ⻚⾯较⼤—>缺⻚率较低—>可以减少⻚表⻓度,但使得⻚内碎⽚增⼤

2. ⻚⾯较⼩—>缺⻚率较⾼

- —>可以减少内存碎⽚,提⾼内存利⽤率

- —>使得⻚表过⻓,占⽤⼤量内存 3. 分配给进程的物理块数越多,缺⻚率就越低 4. 分配给进程的物理块数超过某个值时,对缺⻚率的改善并不明显 5. 好的⻚⾯置换算法可以使进程在运⾏过程中具有较低的缺⻚率 6. LRU,CLOCK将未来可能要⽤到的进程保存在内存中,可以提⾼⻚⾯的访问速度 7. 编写程序的局部化程度越⾼,执⾏时的缺⻚率越低 8. 存储和访问尽量使⽤系统的访问⽅式(如都按⾏存储就按⾏访问)

地址翻译 后续复习再看吧(灬ꈍ ꈍ灬)

本章常⻅的计算题 计算页表级数和页内偏移 LRU算法例题 CLOCK例题 王道书36题,42题 虚拟页面求物理地址 动态分配时计算空闲分区 1000题P227第17题 ⾸次适应法-->1000题P228第19题 第三章 内存管理 2022年9月28日 星期三 20:30